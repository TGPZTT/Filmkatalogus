<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Film Katalógus v2</title>
    <!-- Tailwind CSS betöltése -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide ikonok (JAVÍTVA) -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <!-- Inter betűtípus -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #020617; /* slate-950 */
            color: #f1f5f9; /* slate-100 */
        }
        /* Rejtett fájl bemenet */
        #load-input {
            display: none;
        }
        /* Egyedi scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0f172a; /* slate-900 */
        }
        ::-webkit-scrollbar-thumb {
            background: #334155; /* slate-700 */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #475569; /* slate-600 */
        }
        /* Csillag értékelő (MODÁLBAN) hover effektus */
        .modal-rating-stars:hover .modal-rating-star svg {
            color: #64748b; /* slate-500 */
        }
/* ... (Ezt a részt átnevezzük és módosítjuk) ... */
        .modal-rating-star:hover ~ .modal-rating-star svg {
            color: #334155; /* slate-700 */
        }
        .modal-rating-stars .modal-rating-star:hover svg {
             color: #f59e0b; /* yellow-500 */
        }

        /* ÚJ: Interaktív csillagok a kártyán (átvéve a modál stílusából) */
        .interactive-rating-stars:hover .rating-star svg {
            color: #64748b; /* slate-500 */
        }
        .rating-star:hover ~ .rating-star svg {
            color: #334155; /* slate-700 */
        }
        .interactive-rating-stars .rating-star:hover svg {
             color: #f59e0b; /* yellow-500 */
        }

        /* Címke (tag) stílusok */
        .tag-badge {
            display: inline-flex;
            align-items: center;
            background-color: #334155; /* slate-700 */
            color: #e2e8f0; /* slate-200 */
            font-size: 0.8rem;
            font-weight: 500;
            border-radius: 9999px;
            padding: 3px 10px;
        }
        .tag-badge-interactive {
             padding: 3px 6px 3px 10px;
             background-color: #475569; /* slate-600 */
        }
        .remove-tag-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: #334155; /* slate-700 */
            color: #e2e8f0; /* slate-200 */
            margin-left: 6px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }
        .remove-tag-btn:hover {
            background-color: #ef4444; /* red-500 */
            color: white;
            transform: scale(1.1);
        }
        .add-tag-form {
            display: flex;
            margin-top: 10px;
            gap: 5px;
        }
        .tag-input {
            flex-grow: 1;
            background-color: #1e293b; /* slate-800 */
            border: 1px solid #475569; /* slate-600 */
            color: white;
            border-radius: 6px;
            padding: 8px 10px;
            font-size: 0.9rem;
            min-width: 0;
            outline: none;
        }
        .tag-input:focus {
            border-color: #2563eb; /* blue-600 */
            box-shadow: 0 0 0 2px #1e40af; /* blue-800 */
        }
        .add-tag-btn {
            background-color: #2563eb; /* blue-600 */
            color: white;
            border: none;
            border-radius: 6px;
            padding: 0 12px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .add-tag-btn:hover {
            background-color: #1d4ed8; /* blue-700 */
        }

        /* Ikonok inicializálása */
        /* Lucide betöltés után fut le */
        body.lucide-loaded [data-lucide] {
            display: inline-block;
        }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 antialiased min-h-screen">

    <div class="container mx-auto max-w-7xl p-4 sm:p-8">
        
        <!-- Címsor és Vezérlőpult -->
        <header class="mb-10 p-5 sm:p-6 bg-slate-900 rounded-2xl shadow-xl border border-slate-800">
            <h1 class="text-4xl sm:text-5xl font-bold text-center mb-8 text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">
                Film Katalógus
            </h1>

            <!-- Új film keresése (OMDB) -->
            <form id="search-omdb-form" class="grid grid-cols-1 md:grid-cols-4 gap-5 items-end mb-6">
                <div class="md:col-span-3">
                    <label for="search-term-input" class="block text-sm font-medium text-slate-300 mb-2">Új Film Keresése (OMDB)</label>
                    <input type="text" id="search-term-input" required placeholder="Keresés cím vagy IMDB ID alapján (pl. tt0133093)..." class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all">
                </div>
                <div class="md:col-span-1 text-center">
                    <button type="submit" id="search-omdb-btn" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transform hover:scale-105 transition-all duration-200 flex items-center justify-center gap-2 min-h-[50px]">
                        <span id="search-btn-text">Keresés</span>
                        <!-- Spinner SVG eltávolítva -->
                        <i data-lucide="search" class="w-5 h-5"></i>
                    </button>
                </div>
            </form>

            <hr class="border-slate-700/60 my-6">

            <!-- Helyi keresés és Fájlkezelés -->
            <div class="flex flex-col sm:flex-row flex-wrap gap-4 justify-between items-center">
                <!-- Keresőmező (Helyi katalógusban) -->
                <div class="w-full sm:w-auto sm:flex-1 sm:min-w-[300px]">
                    <label for="search-box" class="block text-sm font-medium text-slate-300 mb-2">Keresés a saját katalógusban</label>
                    <div class="relative">
                        <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">
                            <i data-lucide="search" class="w-5 h-5"></i>
                        </span>
                        <input 
                            type="search" 
                            id="search-box"
                            placeholder="Keresés a filmcímek között..."
                            class="w-full bg-slate-800 border border-slate-700 rounded-lg pl-10 pr-4 py-3 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200"
                        />
                    </div>
                </div>
                <!-- Gombok -->
                <div class="flex gap-3 mt-4 sm:mt-0 self-stretch sm:self-end">
                    <button id="save-btn" class="flex-1 sm:flex-auto bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-5 rounded-lg shadow-md transform hover:scale-105 transition-all duration-200 flex items-center justify-center gap-2">
                        <i data-lucide="save" class="w-5 h-5"></i>
                        Mentés
                    </button>
                    <button id="load-btn" class="flex-1 sm:flex-auto bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-5 rounded-lg shadow-md transform hover:scale-105 transition-all duration-200 flex items-center justify-center gap-2">
                        <i data-lucide="folder-open" class="w-5 h-5"></i>
                        Betöltés
                    </button>
                    <input type="file" id="load-input" accept=".csv">
                </div>
            </div>
        </header>

        <main>
            <!-- ÚJ: Szűrő sáv (Státusz és Címkék) - Feljebb hozva a main-en kívülre -->
            <section id="filter-controls" class="mb-8 p-4 bg-slate-900 rounded-2xl shadow-xl border border-slate-800">
                <div class="flex flex-col md:flex-row gap-4 items-end">
                    <!-- Státusz szűrő -->
                    <div class="w-full md:w-auto">
                        <!-- Label törölve -->
                        <div id="view-filter-controls" class="flex rounded-lg bg-slate-800 border border-slate-700 p-1">
                            <button 
                                data-filter="all"
                                class="view-filter-btn flex-1 px-3 py-1 text-sm font-semibold rounded-md transition-colors bg-blue-600 text-white"
                            >
                                <!-- Ikon eltávolítva -->
                                Mind
                            </button>
                            <button 
                                data-filter="seen"
                                class="view-filter-btn flex-1 px-3 py-1 text-sm font-semibold rounded-md transition-colors bg-slate-800 text-slate-300 hover:bg-slate-700"
                            >
                                <!-- Ikon eltávolítva -->
                                Láttam
                            </button>
                            <button 
                                data-filter="unseen"
                                class="view-filter-btn flex-1 px-3 py-1 text-sm font-semibold rounded-md transition-colors bg-slate-800 text-slate-300 hover:bg-slate-700"
                            >
                                <!-- Ikon eltávolítva -->
                                Megnézendő
                            </button>
                        </div>
                    </div>
    
                    <!-- Címke szűrő -->
                    <div class="w-full md:flex-1">
                        <!-- Label törölve -->
                        <select id="tag-filter-select" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-1 text-sm text-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all">
                            <option value="all">Minden címke</option>
                            <!-- JS tölti fel -->
                        </select>
                    </div>
    
                    <!-- ÚJ: Gemini Ajánló Gomb -->
                    <div class="w-full md:w-auto">
                        <button id="recommendation-btn" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-medium py-1 px-4 rounded-lg shadow-md transform hover:scale-105 transition-all duration-200 flex items-center justify-center gap-2 text-sm">
                            <i data-lucide="sparkles" class="w-5 h-5"></i>
                            <!-- Emoji eltávolítva -->
                            Ajánlj filmet!
                        </button>
                    </div>
                </div>
            </section>

            <!-- Film Katalógus Rács -->
            <section id="movie-catalog">
                <h2 class="text-3xl font-bold mb-6 border-b border-slate-700 pb-3">Saját Katalógus</h2>
                <div id="catalog-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
                    <!-- A film kártyák ide kerülnek beillesztésre JS-sel -->
                </div>
                <p id="no-results" class="text-center text-slate-400 text-xl mt-10 hidden">Nincs a keresésnek megfelelő találat.</p>
                <p id="empty-catalog" class="text-center text-slate-400 text-xl mt-10 hidden">A katalógus még üres. Keress filmeket a fenti űrlappal!</p>
            </section>
        </main>

        <!-- Egyedi üzenet ablak (alert helyett) -->
        <div id="message-box" class="fixed bottom-5 right-5 bg-red-600 text-white py-3 px-5 rounded-lg shadow-lg opacity-0 transition-all duration-300 translate-y-10 z-50 flex items-center gap-3">
            <i id="message-icon-error" data-lucide="alert-triangle" class="w-5 h-5"></i>
            <i id="message-icon-success" data-lucide="check-circle" class="w-5 h-5 hidden"></i>
            <span id="message-text"></span>
        </div>

        <!-- Keresési Eredmények Modál (OMDB) -->
        <div id="search-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-40 hidden items-center justify-center p-4 transition-opacity duration-300">
            <div class="bg-slate-900 w-full max-w-5xl max-h-[85vh] rounded-2xl shadow-xl flex flex-col border border-slate-700">
                <header class="p-5 flex justify-between items-center border-b border-slate-700">
                    <h2 class="text-2xl font-bold">Keresési Eredmények</h2>
                    <button id="close-modal-btn" class="text-slate-400 hover:text-white transition-colors duration-200 rounded-full p-1 hover:bg-slate-700">
                        <i data-lucide="x" class="w-8 h-8"></i>
                    </button>
                </header>
                <div id="search-results-wrapper" class="p-6 overflow-y-auto">
                    <div id="search-results-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-5">
                        <!-- Keresési eredmények kártyái ide jönnek -->
                    </div>
                </div>
                <div id="search-loading" class="p-10 text-center hidden">
                    <svg class="animate-spin h-10 w-10 text-blue-400 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </div>
                <div id="search-no-results" class="p-10 text-center text-slate-400 text-xl hidden">
                    Nincs találat erre a kifejezésre.
                </div>
            </div>
        </div>

        <!-- TÖRÖLVE: Film Szerkesztése Modál -->
        <!-- <div id="edit-modal" ... (az egész modál törölve) ... </div> -->

        <!-- ÚJ: Gemini Ajánló Modál -->
        <div id="recommendation-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-40 hidden items-center justify-center p-4 transition-opacity duration-300">
            <div class="bg-slate-900 w-full max-w-lg rounded-2xl shadow-xl flex flex-col border border-slate-700">
                <header class="p-5 flex justify-between items-center border-b border-slate-700">
                    <h2 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-500">✨ Személyes ajánlás</h2>
                    <button id="close-recommendation-modal-btn" class="text-slate-400 hover:text-white transition-colors duration-200 rounded-full p-1 hover:bg-slate-700">
                        <i data-lucide="x" class="w-8 h-8"></i>
                    </button>
                </header>
                <div class="p-6 overflow-y-auto min-h-[200px] flex items-center justify-center">
                    <!-- Töltő -->
                    <div id="recommendation-loading" class="text-center hidden">
                        <svg class="animate-spin h-10 w-10 text-purple-400 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <p class="mt-4 text-slate-300">Gondolkodom az ízléseden...</p>
                    </div>
                    <!-- Tartalom -->
                    <div id="recommendation-content" class="text-slate-200 leading-relaxed">
                        <!-- Az ajánlás ide jön -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Globális Datalist az autokiegészítéshez -->
    <datalist id="all-tags-list">
        <!-- JS tölti fel -->
    </datalist>

        <script>
        document.addEventListener('DOMContentLoaded', () => {
            // === DOM Elemek ===
            const searchOmdbForm = document.getElementById('search-omdb-form');
            const searchTermInput = document.getElementById('search-term-input');
            const searchOmdbBtn = document.getElementById('search-omdb-btn');
            const searchBtnText = document.getElementById('search-btn-text');
            // const searchBtnSpinner = document.getElementById('search-btn-spinner'); // Eltávolítva
            
            const catalogGrid = document.getElementById('catalog-grid');
            const searchBox = document.getElementById('search-box'); // Helyi kereső
            
            const saveBtn = document.getElementById('save-btn');
            const loadBtn = document.getElementById('load-btn');
            const loadInput = document.getElementById('load-input');
            
            const noResultsMsg = document.getElementById('no-results');
            const emptyCatalogMsg = document.getElementById('empty-catalog');
            
            const messageBox = document.getElementById('message-box');
            const messageText = document.getElementById('message-text'); // HIÁNYZOTT
            const messageIconError = document.getElementById('message-icon-error'); // HIÁNYZOTT
            const messageIconSuccess = document.getElementById('message-icon-success'); // HIÁNYZOTT

            // Modál elemek (OMDB) - HIÁNYOZTAK
            const searchModal = document.getElementById('search-modal');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const searchResultsWrapper = document.getElementById('search-results-wrapper');
            const searchResultsGrid = document.getElementById('search-results-grid');
            const searchLoading = document.getElementById('search-loading');
            const searchNoResults = document.getElementById('search-no-results');

            // ÚJ: Szűrő elemek
            const tagFilterSelect = document.getElementById('tag-filter-select');
            const viewFilterControls = document.getElementById('view-filter-controls');
            const viewFilterButtons = viewFilterControls.querySelectorAll('.view-filter-btn');

            // ÚJ: Gemini Ajánló Elemek
            const recommendationBtn = document.getElementById('recommendation-btn');
            const recommendationModal = document.getElementById('recommendation-modal');
            const closeRecommendationModalBtn = document.getElementById('close-recommendation-modal-btn');
            const recommendationLoading = document.getElementById('recommendation-loading');
            const recommendationContent = document.getElementById('recommendation-content');


            // === Alkalmazás állapota (State) ===
            let movies = [];
            let allTags = [];
            const OMDB_API_KEY = '7f4955d5'; // Felhasználó által biztosított kulcs

            // ÚJ: Szűrési állapot
            let currentTagFilter = 'all';
            let currentViewFilter = 'all';

            // === FUNKCIÓK ===

            /**
             * Lucide ikonok inicializálása
             */
            function initIcons() {
                if (window.lucide) {
                    lucide.createIcons();
                    document.body.classList.add('lucide-loaded');
                }
            }

            // --- VISSZAÁLLÍTOTT ALAP FUNKCIÓK ---

            /**
             * Egyedi üzenet megjelenítése (alert helyett)
             */
            function showMessage(message, type = 'error') {
                messageText.textContent = message;
                messageBox.classList.remove('bg-red-600', 'bg-green-600');
                messageIconError.classList.add('hidden');
                messageIconSuccess.classList.add('hidden');

                if (type === 'success') {
                    messageBox.classList.add('bg-green-600');
                    messageIconSuccess.classList.remove('hidden');
                } else {
                    messageBox.classList.add('bg-red-600');
                    messageIconError.classList.remove('hidden');
                }

                messageBox.classList.remove('opacity-0', 'translate-y-10');
                initIcons(); // Frissítjük az ikonokat az üzenetben

                setTimeout(() => {
                    messageBox.classList.add('opacity-0', 'translate-y-10');
                }, 3000);
            }

            /**
             * A filmek tömb alapján újrarendereli a *saját* katalógus nézetet.
             */
            function renderMovies(movieList = movies) {
                catalogGrid.innerHTML = '';
                noResultsMsg.classList.add('hidden');
                emptyCatalogMsg.classList.add('hidden');

                if (movies.length === 0) {
                    emptyCatalogMsg.classList.remove('hidden');
                    return;
                }

                if (movieList.length === 0 && movies.length > 0) {
                    noResultsMsg.classList.remove('hidden');
                    return;
                }

                movieList.forEach(movie => {
                    // Csillagok generálása
                    let starsHTML = '';
                    for (let i = 1; i <= 5; i++) {
                        const starClass = movie.userRating >= i ? 'text-yellow-400' : 'text-slate-600';
                        starsHTML += `
                            <svg data-value="${i}" class="rating-star w-6 h-6 cursor-pointer ${starClass} hover:text-yellow-300" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                            </svg>
                        `;
                    }

                    // Címkék generálása
                    let tagsHTML = '';
                    if (movie.tags && movie.tags.length > 0) {
                        movie.tags.forEach(tag => {
                            tagsHTML += `
                                <span class="tag-badge tag-badge-interactive">
                                    ${tag}
                                    <button 
                                        class="remove-tag-btn" 
                                        data-movie-id="${movie.id}" 
                                        data-tag-name="${tag}"
                                        title="Címke törlése"
                                    >
                                        &times;
                                    </button>
                                </span>
                            `;
                        });
                    } else {
                        tagsHTML = '<span class="text-sm text-slate-500 italic">Nincsenek címkék</span>';
                    }

                    // A film kártya HTML
                    const movieCard = `
                        <div class="bg-slate-900 rounded-lg shadow-lg overflow-hidden transform hover:scale-[1.03] transition-transform duration-300 group relative flex flex-col border border-slate-800">
                            <div class="relative w-full aspect-[2/3] bg-slate-800">
                                <img 
                                    src="${movie.poster}" 
                                    alt="${movie.title} poszter" 
                                    class="w-full h-full object-cover"
                                    onerror="this.onerror=null; this.src='https://placehold.co/400x600/334155/94a3b8?text=Kép\\nHiba'; this.classList.add('object-contain');"
                                >
                                <div class="absolute top-3 right-3 flex flex-col gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-10">
                                    <button 
                                        data-id="${movie.id}" 
                                        class="delete-btn bg-red-600 text-white rounded-full p-0 w-8 h-8 flex items-center justify-center hover:bg-red-700 transform hover:scale-110 transition-all"
                                        title="Film törlése"
                                    >
                                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="p-4 flex flex-col flex-grow">
                                <h3 class="text-lg font-bold mb-2 truncate" title="${movie.title}">${movie.title}</h3>
                                <div class="interactive-rating-stars flex items-center my-2" data-id="${movie.id}" title="Saját értékelés: ${movie.userRating}/5">
                                    ${starsHTML}
                                </div>
                                <div class="flex flex-wrap gap-1.5 mt-2 mb-4 min-h-[28px]">
                                    ${tagsHTML}
                                </div>
                                <form class="add-tag-form mb-4" data-id="${movie.id}">
                                    <input type="text" list="all-tags-list" class="tag-input" placeholder="Címke hozzáadása...">
                                    <button type="submit" class="add-tag-btn" title="Hozzáadás">
                                        <i data-lucide="plus" class="w-5 h-5"></i>
                                    </button>
                                </form>
                                ${movie.imdb ? `
                                <a 
                                    href="${movie.imdb}" 
                                    target="_blank" 
                                    rel="noopener noreferrer" 
                                    class="inline-block bg-yellow-500 text-gray-900 text-sm font-semibold px-3 py-1 rounded-full hover:bg-yellow-400 transition-colors duration-200 self-start mt-auto"
                                >
                                    IMDB
                                </a>
                                ` : ''}
                            </div>
                        </div>
                    `;
                    catalogGrid.innerHTML += movieCard;
                });
                initIcons(); // Ikonok frissítése a kártyákon
            }

            /**
             * Menti a jelenlegi film listát a localStorage-be.
             */
            function saveToLocalStorage() {
                localStorage.setItem('movieCatalog', JSON.stringify(movies));
                localStorage.setItem('movieTags', JSON.stringify(allTags));
            }

            /**
             * Betölti a filmeket a localStorage-ből.
             */
            function loadFromLocalStorage() {
                const savedMovies = localStorage.getItem('movieCatalog');
                if (savedMovies) {
                    movies = JSON.parse(savedMovies);
                    movies.forEach(m => {
                        if (m.userRating === undefined) m.userRating = 0;
                        if (m.tags === undefined) m.tags = [];
                    });
                }
                const savedTags = localStorage.getItem('movieTags');
                if (savedTags) {
                    allTags = JSON.parse(savedTags);
                }
            }

            /**
             * Frissíti a globális <datalist>-et az autokiegészítéshez
             */
            function updateAllTagsDatalist() {
                const datalist = document.getElementById('all-tags-list');
                if (datalist) {
                    datalist.innerHTML = '';
                    allTags.forEach(tag => {
                        datalist.innerHTML += `<option value="${tag}">`;
                    });
                }
            }

            /**
             * Frissíti a címke szűrő lenyílót
             */
            function updateTagFilterDropdown() {
                const selectedValue = tagFilterSelect.value;
                tagFilterSelect.innerHTML = '<option value="all">Minden címke</option>';
                allTags.forEach(tag => {
                    tagFilterSelect.innerHTML += `<option value="${tag}">${tag}</option>`;
                });
                // Próbáljuk visszaállítani a kiválasztott értéket, ha még létezik a listában
                tagFilterSelect.value = allTags.includes(selectedValue) ? selectedValue : 'all';
            }

            /**
             * Keresés gomb állapotának kezelése (spinner nélkül)
             */
            function setSearchButtonLoading(isLoading) {
                const icon = searchOmdbBtn.querySelector('[data-lucide="search"]');
                if (isLoading) {
                    searchOmdbBtn.disabled = true;
                    searchBtnText.classList.add('hidden');
                    if(icon) icon.classList.add('hidden');
                } else {
                    searchOmdbBtn.disabled = false;
                    searchBtnText.classList.remove('hidden');
                    if(icon) icon.classList.remove('hidden');
                }
            }

            /**
             * Film keresése az OMDB-n cím alapján.
             */
            async function handleOMDBSearch(e) {
                e.preventDefault();
                const searchTerm = searchTermInput.value.trim();
                if (!searchTerm) {
                    showMessage('Kérlek, adj meg egy filmcímet a kereséshez!');
                    return;
                }

                setSearchButtonLoading(true);
                searchModal.classList.remove('hidden');
                searchModal.classList.add('flex');
                searchLoading.classList.remove('hidden');
                searchNoResults.classList.add('hidden');
                searchResultsGrid.innerHTML = '';
                searchResultsWrapper.scrollTop = 0; // Görgetés tetejére

                // Regex az IMDB ID formátum ellenőrzésére (pl. tt1234567)
                const imdbIdPattern = /^tt\d{7,9}$/i;
                let apiUrl = '';

                if (imdbIdPattern.test(searchTerm)) {
                    // Keresés IMDB ID alapján (egy film)
                    apiUrl = `https://www.omdbapi.com/?i=${searchTerm}&apikey=${OMDB_API_KEY}`;
                } else {
                    // Keresés cím alapján (lista)
                    apiUrl = `https://www.omdbapi.com/?s=${searchTerm}&apikey=${OMDB_API_KEY}`;
                }

                try {
                    const response = await fetch(apiUrl);
                    const data = await response.json();

                    if (data.Response === "True") {
                        if (imdbIdPattern.test(searchTerm)) {
                            // ID keresés egyetlen objektumot ad vissza.
                            renderSearchResults([data]);
                        } else {
                            // Cím keresés listát ad (data.Search)
                            renderSearchResults(data.Search);
                        }
                        searchNoResults.classList.add('hidden');
                    } else {
                        searchNoResults.classList.remove('hidden');
                    }
                } catch (error) {
                    console.error("OMDB Keresési Hiba:", error);
                    showMessage('Hiba történt a keresés közben. Ellenőrizd az internetkapcsolatot.');
                    searchNoResults.classList.remove('hidden');
                } finally {
                    setSearchButtonLoading(false);
                    searchLoading.classList.add('hidden');
                    initIcons(); // Modál ikonjainak frissítése
                }
            }
            
            /**
             * Keresési eredmények megjelenítése a modálban.
             */
            function renderSearchResults(results) {
                searchResultsGrid.innerHTML = '';
                results.forEach(result => {
                    // Ellenőrizzük, hogy ez a film már a listánkon van-e
                    const alreadyAdded = movies.some(m => m.imdb && m.imdb.includes(result.imdbID));
                    
                    const card = `
                        <div class="bg-slate-800 rounded-lg shadow-lg overflow-hidden flex flex-col border border-slate-700">
                            <img 
                                src="${result.Poster}" 
                                alt="${result.Title} poszter" 
                                class="w-full h-80 object-cover"
                                onerror="this.onerror=null; this.src='https://placehold.co/300x450/334155/94a3b8?text=Nincs\\nPoszter'; this.classList.add('object-contain');"
                            >
                            <div class="p-4 flex flex-col flex-grow">
                                <h3 class="text-lg font-bold mb-1 truncate flex-grow" title="${result.Title}">${result.Title}</h3>
                                <p class="text-sm text-slate-400 mb-4">${result.Year}</p>
                                <button 
                                    class="add-from-search-btn w-full mt-auto px-4 py-2 rounded-lg font-semibold transition-all duration-200 flex items-center justify-center gap-2 ${alreadyAdded ? 'bg-green-600 text-white cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700 text-white'}"
                                    data-imdbid="${result.imdbID}"
                                    ${alreadyAdded ? 'disabled' : ''}
                                >
                                    <i data-lucide="${alreadyAdded ? 'check' : 'plus'}" class="w-4 h-4"></i>
                                    ${alreadyAdded ? 'Hozzáadva' : 'Hozzáadás'}
                                </button>
                            </div>
                        </div>
                    `;
                    searchResultsGrid.innerHTML += card;
                });
                initIcons(); // Gombok ikonjainak frissítése
            }

            /**
             * Film hozzáadása a keresési eredményből (modálból).
             */
            async function handleAddFromSearch(e) {
                const btn = e.target.closest('.add-from-search-btn');
                if (!btn) return;

                btn.disabled = true;
                btn.innerHTML = '<i data-lucide="loader" class="w-4 h-4 animate-spin"></i> Hozzáadás...';
                initIcons();
                const imdbID = btn.dataset.imdbid;

                // Ellenőrzés (dupla kattintás ellen)
                if (movies.some(m => m.imdb && m.imdb.includes(imdbID))) {
                    btn.innerHTML = '<i data-lucide="check" class="w-4 h-4"></i> Hozzáadva';
                    initIcons();
                    return;
                }

                try {
                    // Teljes filmadatok lekérése ID alapján
                    const response = await fetch(`https://www.omdbapi.com/?i=${imdbID}&apikey=${OMDB_API_KEY}`);
                    const data = await response.json();

                    if (data.Response === "False") {
                        showMessage(`Hiba: ${data.Error || 'Ismeretlen hiba.'}`);
                        btn.disabled = false;
                        btn.innerHTML = '<i data-lucide="plus" class="w-4 h-4"></i> Hozzáadás';
                        initIcons();
                        return;
                    }

                    const newMovie = {
                        id: crypto.randomUUID(),
                        title: data.Title,
                        imdb: `https://www.imdb.com/title/${data.imdbID}/`,
                        poster: data.Poster,
                        userRating: 0,
                        tags: []
                    };

                    movies.unshift(newMovie); // Hozzáadás a tömb elejére
                    saveToLocalStorage();
                    updateCatalogView(); // Fő rács frissítése
                    showMessage('Film sikeresen hozzáadva!', 'success');
                    btn.innerHTML = '<i data-lucide="check" class="w-4 h-4"></i> Hozzáadva';
                    initIcons();

                } catch (error) {
                    console.error("OMDB Hozzáadási Hiba:", error);
                    showMessage('Hiba történt a film hozzáadása közben.');
                    btn.disabled = false;
                    btn.innerHTML = '<i data-lucide="plus" class="w-4 h-4"></i> Hozzáadás';
                    initIcons();
                }
            }
            
            /**
             * OMDB Modál bezárása.
             */
            function closeSearchModal() {
                searchModal.classList.add('hidden');
                searchModal.classList.remove('flex');
            }

            /**
             * Film törlése ID alapján.
             */
            function deleteMovie(id) {
                movies = movies.filter(movie => movie.id !== id);
                saveToLocalStorage();
                updateCatalogView();
                showMessage('Film törölve.', 'success');
                // Frissítjük a modál gombjait, ha nyitva van
                updateModalButtons();
            }

            /**
             * Frissíti a modálban lévő gombok állapotát (pl. törlés után)
             */
            function updateModalButtons() {
                const buttons = searchResultsGrid.querySelectorAll('.add-from-search-btn');
                buttons.forEach(btn => {
                    const imdbID = btn.dataset.imdbid;
                    const alreadyAdded = movies.some(m => m.imdb && m.imdb.includes(imdbID));
                    if (alreadyAdded) {
                        btn.disabled = true;
                        btn.innerHTML = '<i data-lucide="check" class="w-4 h-4"></i> Hozzáadva';
                        btn.classList.add('bg-green-600', 'cursor-not-allowed');
                        btn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                    } else {
                        btn.disabled = false;
                        btn.innerHTML = '<i data-lucide="plus" class="w-4 h-4"></i> Hozzáadás';
                        btn.classList.remove('bg-green-600', 'cursor-not-allowed');
                        btn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                    }
                });
                initIcons(); // Gomb ikonok frissítése
            }

            /**
             * Visszaadja a szűrt filmek listáját.
             */
            function getFilteredMovies() {
                const searchTerm = searchBox.value.toLowerCase();
                // Szűrés mindhárom állapot alapján
                return movies.filter(movie => {
                    const titleMatch = movie.title.toLowerCase().includes(searchTerm);
                    
                    const tagMatch = (currentTagFilter === 'all') || (movie.tags && movie.tags.includes(currentTagFilter));
                    
                    const viewMatch = (currentViewFilter === 'all') ||
                                      (currentViewFilter === 'seen' && movie.userRating > 0) ||
                                      (currentViewFilter === 'unseen' && movie.userRating === 0);
                    
                    return titleMatch && tagMatch && viewMatch;
                });
            }

            /**
             * Általános nézet frissítő (keresés/szűrés).
             */
            function updateCatalogView() {
                renderMovies(getFilteredMovies());
            }

            // --- Fájlkezelés ---
            function escapeCSV(str) {
                if (str === null || str === undefined) str = "";
                str = String(str);
                if (str.includes(',') || str.includes('"') || str.includes('\n')) {
                    return `"${str.replace(/"/g, '""')}"`;
                }
                return str;
            }

            function saveCatalogToFile() {
                if (movies.length === 0) {
                    showMessage('Nincs mit menteni, a katalógus üres!');
                    return;
                }
                
                const header = "id,title,imdb,poster,userRating,tags\n";
                const rows = movies.map(m => {
                    return [
                        escapeCSV(m.id),
                        escapeCSV(m.title),
                        escapeCSV(m.imdb),
                        escapeCSV(m.poster),
                        escapeCSV(m.userRating),
                        escapeCSV(m.tags ? m.tags.join('|') : "")
                    ].join(',');
                }).join('\n');

                const csvContent = header + rows;
                const blob = new Blob(["\uFEFF" + csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = 'film_katalogus.csv';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showMessage('Katalógus sikeresen mentve (.csv)!', 'success');
            }

            function triggerLoadFile() {
                loadInput.click();
            }

            function parseCSVLine(line) {
                const values = [];
                let current = '';
                let inQuotes = false;

                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    if (char === '"') {
                        if (inQuotes && line[i+1] === '"') {
                            current += '"';
                            i++;
                        } else {
                             inQuotes = !inQuotes;
                        }
                    } else if (char === ',' && !inQuotes) {
                        values.push(current);
                        current = '';
                    } else {
                        current += char;
                    }
                }
                values.push(current);
                
                return values.map(v => {
                    let val = v.trim();
                    if (val.startsWith('"') && val.endsWith('"')) {
                        val = val.substring(1, val.length - 1);
                    }
                    return val.replace(/""/g, '"');
                });
            }

            function handleFileLoad(e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const csvData = event.target.result;
                        const lines = csvData.split(/\r?\n/); 

                        if (lines.length < 2) {
                            showMessage('A CSV fájl üres vagy érvénytelen.');
                            return;
                        }

                        const headerLine = lines.shift().toLowerCase().replace("\uFEFF", "");
                        const headers = headerLine.split(',').map(h => h.trim());
                        
                        const idIndex = headers.indexOf('id');
                        const titleIndex = headers.indexOf('title');
                        const imdbIndex = headers.indexOf('imdb');
                        const posterIndex = headers.indexOf('poster');
                        const userRatingIndex = headers.indexOf('userrating');
                        const tagsIndex = headers.indexOf('tags');

                        if (idIndex === -1 || titleIndex === -1 || imdbIndex === -1 || posterIndex === -1) {
                            showMessage('A CSV fejléc hiányos. Kötelező oszlopok: id, title, imdb, poster');
                            return;
                        }

                        const importedMovies = [];
                        for (const line of lines) {
                            if (line.trim() === '') continue; 

                            const values = parseCSVLine(line);

                            if (values.length >= 4) {
                                const movie = {
                                    id: values[idIndex],
                                    title: values[titleIndex],
                                    imdb: values[imdbIndex],
                                    poster: values[posterIndex],
                                    userRating: userRatingIndex > -1 ? (parseInt(values[userRatingIndex], 10) || 0) : 0,
                                    tags: tagsIndex > -1 && values[tagsIndex] ? values[tagsIndex].split('|').filter(t => t.length > 0) : []
                                };
                                if (movie.id && movie.title && movie.poster) {
                                    importedMovies.push(movie);
                                }
                            }
                        }
                        
                        const importedTags = new Set(allTags);
                        importedMovies.forEach(m => {
                            m.tags.forEach(t => importedTags.add(t));
                        });
                        allTags = Array.from(importedTags).sort();
                        updateAllTagsDatalist();
                        updateTagFilterDropdown(); 

                        movies = importedMovies;
                        saveToLocalStorage();
                        updateCatalogView(); 
                        searchBox.value = '';
                        showMessage(`Katalógus sikeresen betöltve! (${importedMovies.length} film importálva)`, 'success');
                        
                    } catch (error) {
                        showMessage('Hiba történt a CSV fájl beolvasása közben.');
                        console.error("CSV Parse Error:", error);
                    }
                };
                
                reader.onerror = () => showMessage('Hiba történt a fájl olvasása közben.');
                reader.readAsText(file, "UTF-8");
                e.target.value = null;
            }

            // --- Kártyán belüli szerkesztő funkciók ---
            function handleRatingClick(movieId, ratingValue) {
                const movie = movies.find(m => m.id === movieId);
                if (!movie) return;

                // Ha ugyanarra a csillagra kattint, nullázza
                if (movie.userRating === ratingValue) {
                    movie.userRating = 0; 
                } else {
                    movie.userRating = ratingValue;
                }

                saveToLocalStorage();
                updateCatalogView();
                showMessage(`Értékelés mentve: ${movie.userRating} ⭐`, 'success');
            }

            function handleAddTag(movieId, tagName) {
                const movie = movies.find(m => m.id === movieId);
                if (movie && !movie.tags.includes(tagName)) {
                    movie.tags.push(tagName);
                    movie.tags.sort();

                    if (!allTags.includes(tagName)) {
                        allTags.push(tagName);
                        allTags.sort();
                        updateAllTagsDatalist();
                        updateTagFilterDropdown(); // Frissítjük a szűrőt is
                    }
                    
                    saveToLocalStorage();
                    updateCatalogView();
                }
            }

            function handleRemoveTag(movieId, tagName) {
                const movie = movies.find(m => m.id === movieId);
                if (movie) {
                    movie.tags = movie.tags.filter(t => t !== tagName);
                    saveToLocalStorage();
                    updateCatalogView();
                }
            }
            
            // --- Szűrő eseménykezelők ---
            function handleTagFilterChange() {
                currentTagFilter = tagFilterSelect.value;
                updateCatalogView();
            }

            function handleViewFilterClick(e) {
                const btn = e.target.closest('.view-filter-btn');
                if (!btn) return;

                currentViewFilter = btn.dataset.filter;

                // Gombok stílusának frissítése
                viewFilterButtons.forEach(b => {
                    b.classList.remove('bg-blue-600', 'text-white');
                    b.classList.add('bg-slate-800', 'text-slate-300', 'hover:bg-slate-700');
                });
                btn.classList.add('bg-blue-600', 'text-white');
                btn.classList.remove('bg-slate-800', 'text-slate-300', 'hover:bg-slate-700');

                updateCatalogView();
            }

            // --- ÚJ: Gemini API Hívás és Kezelés ---

            /**
             * Általános fetch hívás újrapróbálkozással (exponential backoff)
             */
            async function retryFetch(url, options, retries = 3, delay = 1000) {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) {
                        // Csak 429 (Túl sok kérés) vagy 5xx (Szerverhiba) esetén próbáljuk újra
                        if ((response.status === 429 || response.status >= 500) && retries > 0) {
                            // Ne logoljuk konzolra az újrapróbálkozást (az utasítás szerint)
                            await new Promise(res => setTimeout(res, delay));
                            return retryFetch(url, options, retries - 1, delay * 2);
                        } else {
                            // Egyéb kliens oldali hibáknál (pl. 400 Bad Request) ne próbálkozzunk újra
                            throw new Error(`API hiba ${response.status}: ${response.statusText}`);
                        }
                    }
                    return response.json();
                } catch (error) {
                    // Hálózati hiba vagy egyéb fetch hiba esetén is újrapróbálkozás
                    if (retries > 0) {
                        await new Promise(res => setTimeout(res, delay));
                        return retryFetch(url, options, retries - 1, delay * 2);
                    } else {
                        // Ha elfogytak az újrapróbálkozások, dobjuk a hibát
                        console.error("API hívás végleg sikertelen:", error);
                        throw error;
                    }
                }
            }


            /**
             * Gemini API hívása
             * @param {string} systemPrompt - A rendszerüzenet (persona)
             * @param {string} userQuery - A felhasználói kérés
             * @returns {Promise<string>} A generált szöveg
             */
            async function callGeminiAPI(systemPrompt, userQuery) {
                const apiKey = ""; // Az utasításoknak megfelelően üresen hagyva
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    systemInstruction: {
                        parts: [{ text: systemPrompt }]
                    },
                };

                const options = {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                };

                // A retryFetch már JSON-t ad vissza
                const result = await retryFetch(apiUrl, options);
                
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                if (!text) {
                    throw new Error("Érvénytelen API válaszstruktúra.");
                }
                return text;
            }

            /**
             * Ajánló gomb kattintásának kezelője
             */
            async function handleRecommendationClick() {
                // 1. Modál megnyitása és töltő mutatása
                recommendationModal.classList.remove('hidden');
                recommendationModal.classList.add('flex');
                recommendationContent.innerHTML = '';
                recommendationLoading.classList.remove('hidden');
                initIcons(); // Modál ikonjainak frissítése

                // 2. Értékelt filmek gyűjtése
                const seenMovies = movies.filter(m => m.userRating > 0);

                if (seenMovies.length < 3) {
                    recommendationContent.innerHTML = 'Nincs elég adatod! Adj értékelést legalább 3 filmnek, hogy személyre szabott ajánlást kaphass.';
                    recommendationLoading.classList.add('hidden');
                    return;
                }

                // 3. Prompt összeállítása
                const movieListString = seenMovies.map(m => `${m.title} (${m.userRating}/5 csillag)`).join(', ');
                
                const systemPrompt = "Te egy filmkritikus és ajánló szakértő vagy. A felhasználó elküldi a kedvenc filmjeinek listáját és azok értékelését. A te feladatod, hogy ez alapján ajánlj neki EGYETLEN új filmet. Az ajánlásnak tartalmaznia kell a film címét (magyarul és angolul is), a megjelenési évét, és 1-2 mondatos, meggyőző indoklást, hogy miért tetszene neki az eddigi ízlése alapján. Kizárólag magyar nyelven válaszolj. Ne írj semmilyen üdvözlést vagy elköszönést, csak a filmcím, év és az indoklás szerepeljen.";
                
                const userQuery = `Az én listám: ${movieListString}. EZEK ALAPJÁN ajánlj nekem egy új filmet.`;

                try {
                    // 4. API hívás
                    const recommendationText = await callGeminiAPI(systemPrompt, userQuery);

                    // 5. Eredmény megjelenítése (formázva)
                    recommendationContent.innerHTML = recommendationText
                        .replace(/\*\*(.*?)\*\*/g, '<strong class="text-purple-300">$1</strong>') // Félkövér kiemelés
                        .replace(/\n/g, '<br>'); // Sortörések
                    
                } catch (error) {
                    console.error("Gemini hiba:", error);
                    recommendationContent.innerHTML = '<span class="text-red-400">Hiba történt az ajánlás kérése közben. Kérlek, próbáld újra később.</span>';
                } finally {
                    // 6. Töltő elrejtése
                    recommendationLoading.classList.add('hidden');
                }
            }

            /**
             * Ajánló modál bezárása
             */
            function closeRecommendationModal() {
                recommendationModal.classList.add('hidden');
                recommendationModal.classList.remove('flex');
                recommendationLoading.classList.add('hidden');
                recommendationContent.innerHTML = '';
            }

            // === ESEMÉNYKEZELŐK RÁKÖTÉSE ===

            // Keresés az OMDB-n
            searchOmdbForm.addEventListener('submit', handleOMDBSearch);

            // OMDB Modál bezárása
            closeModalBtn.addEventListener('click', closeSearchModal);
            searchModal.addEventListener('click', (e) => {
                if (e.target === searchModal) closeSearchModal();
            });

            // Hozzáadás a modálból
            searchResultsGrid.addEventListener('click', handleAddFromSearch);
            
            // Keresés a *helyi* katalógusban
            searchBox.addEventListener('input', updateCatalogView);

            // Törlés VAGY Szerkesztés a *saját* katalógusból (Event Delegation)
            catalogGrid.addEventListener('click', (e) => {
                const deleteBtn = e.target.closest('.delete-btn');
                const ratingStar = e.target.closest('.rating-star');
                const removeTagBtn = e.target.closest('.remove-tag-btn');

                if (deleteBtn) {
                    const id = deleteBtn.dataset.id;
                    deleteMovie(id);
                    return;
                }
                
                if (ratingStar) {
                    const id = ratingStar.parentElement.dataset.id;
                    const ratingValue = parseInt(ratingStar.dataset.value, 10);
                    handleRatingClick(id, ratingValue);
                    return;
                }

                if (removeTagBtn) {
                    const movieId = removeTagBtn.dataset.movieId;
                    const tagName = removeTagBtn.dataset.tagName;
                    handleRemoveTag(movieId, tagName);
                    return;
                }
            });

            // ÚJ: Címke hozzáadása űrlap kezelése (kártyán belül)
            catalogGrid.addEventListener('submit', (e) => {
                const addTagForm = e.target.closest('.add-tag-form');
                if (addTagForm) {
                    e.preventDefault();
                    const movieId = addTagForm.dataset.id;
                    const input = addTagForm.querySelector('.tag-input');
                    const tagName = input.value.trim();
                    
                    if (tagName) {
                        handleAddTag(movieId, tagName);
                        input.value = '';
                    }
                }
            });

            // Fájlkezelő gombok
            saveBtn.addEventListener('click', saveCatalogToFile);
            loadBtn.addEventListener('click', triggerLoadFile);
            loadInput.addEventListener('change', handleFileLoad);
            
            // ÚJ: Szűrők eseménykezelői
            tagFilterSelect.addEventListener('change', handleTagFilterChange);
            viewFilterControls.addEventListener('click', handleViewFilterClick);

            // ÚJ: Gemini Ajánló eseménykezelői
            recommendationBtn.addEventListener('click', handleRecommendationClick);
            closeRecommendationModalBtn.addEventListener('click', closeRecommendationModal);
            recommendationModal.addEventListener('click', (e) => {
                if (e.target === recommendationModal) closeRecommendationModal();
            });


            // === INICIALIZÁLÁS ===
            loadFromLocalStorage();
            updateAllTagsDatalist();
            updateTagFilterDropdown(); // ÚJ
            updateCatalogView(); // renderMovies() helyett
            initIcons(); // Legelső ikon inicializálás
        });
    </script>

</body>
</html>



